![image](https://github.com/user-attachments/assets/5622cb49-6c88-4502-9132-fd92fc0143d8)

这是我的一个小项目，配合PLC与机械结构进行通讯，通过旋转一周采集散点进行拟合计算，实现检测一个轴体（圆轴或方轴）的中心偏移量的角度和方向。根据所有传感器获取的轴管状态进行一定的下压策略对轴管进行校正。

jzj3.5文件内的是软件的部分实现，在dotnet3.5上进行的，该部分内容还不完整，但是可以在你的电脑上直接运行，只需要在Windows操作系统上安装.NET3.5之后。这部分内容是当时的一次大胆尝试，但最终作者还是选择了python+pyqt5的技术路线。

相关conda环境还没有打包，因为我是在我之前的深度学习pytorch环境上直接进行的，主要使用的环境也就是PyQt5，主要使用的一些环境版本简单放一下。


![1733099220385](https://github.com/user-attachments/assets/06e19d09-f004-4d67-9886-32a903633e95)


这个项目能干哈？

可以为你提供一个简单的PYQT、WDF界面，并在这个基础上可以修改为你的专属界面，在这个项目中有多种UI实现，

包括button和鼠标事件的绑定、日志的不同颜色输出、子窗口的创建和管理、多种布局的嵌套、单选按钮的创建和管理、输入框的非数字输入限制、信号与槽的应用 and so on。


本项目的基本动作逻辑已经完全在现场进行了实验，且取得了有效成果，但下压策略主要为自制的sigmod曲线拟合，欢迎其他人尝试不同的下压策略对校正过程的影响。
主要的下压逻辑有：

1·每个点位设置偏差容许量，七个传感器分别为1.2、1.2、2.4、2.4、2.4、1.2、1.2，单位为毫米。

2·优先恢复两端四个传感器的偏差校正。

3·中间三个传感器位置为方形，校正需要选出投影最大的一个角度对平面进行过压校正。

4·使用自然底数e对最大的偏差loss进行映射，避免过量过压对轴管的不可逆损害。

5·将下压量权重分一部分到相邻轴管的点积上，避免压1过弯2，再压2过弯1。

6·使用sigmod函数对相邻轴管点积进行映射。

7·压前后，直线传感器的变化过小时使用连击，增加一定下压量后直接进行过压打击。

8·连着两次打击位置相似时增大打击量。

关于本项目的界面介绍：

![0](https://github.com/user-attachments/assets/cf14261b-d9e0-4775-a489-7eefe510fad2)

这是软件的自动页面，用以启动轴管自动矫直功能，启动后机械结构会先调用plc的所有初始化函数，并等待plc中m区域中的三个标志位动作完成。然后执行检测、下压打击、检测...直至合格，然后出料且申请上料并进入下一个循环。如果过程中按下机械急停或软件申请结束将结束自动。

在自动页面可以选择矫直轴管的类型，目前有⚪⚪■■■⚪⚪、⚪⚪⚪⚪⚪⚪⚪和⚪■■■■■⚪三种类型的轴管。

![1](https://github.com/user-attachments/assets/28a42b9d-c8dc-47be-a95f-8b74573a2347)

在半自动页面可以调试直线传感器、轴卡、采集卡和最小二乘拟合算法，其中“自动拟合”按键会调用轴卡旋转一周，启用采集卡获取数据，启用算法计算偏移量，更新至当前界面结果，柱状图显示为偏移量，绿色表示合格，红色表示超差，圆形和方形控件中的指针表示高点偏转方向。

![2](https://github.com/user-attachments/assets/d5933b35-e134-4c4d-b175-5f7742925d2e)

手动页面继承了所有的点动控制功能，分别调用plc中对应的模块

![3](https://github.com/user-attachments/assets/7e414c2c-2622-4d61-867d-c7a097fd225d)

参数设置页面包含PLC的通讯测试，和下压相关的参数设置，对应为parama.txt文件，修改后点击设置并更新会将最新的数据存入parama.txt文件，首次打开软件也会调用parama.txt文件中的默认值，当修改后忘记保存，会在退出软件时保存至parama.txt文件。

![4](https://github.com/user-attachments/assets/a8157c5f-2143-4650-bf17-9f3f7ef83e13)

传感器曲线界面和半自动界面中的‘开始采集’、‘结束采集’相绑定，可以查看七个传感器的数据，本界面中未连接传感器，故均为默认值，七条曲线重叠在一起。

PLC大致模块如下：

![6](https://github.com/user-attachments/assets/24713c6a-39be-4ec1-8314-fae8f308ea69)

主要有夹爪准备、夹爪复位、夹爪备压、下压、步进等。

硬件接线如下：

![企业微信截图_17459181036197](https://github.com/user-attachments/assets/72bed580-bccb-48dd-9197-cd027af995be)

![企业微信截图_17459181402286](https://github.com/user-attachments/assets/4449f187-d96d-4912-bb75-421cadd8a1fd)

![企业微信截图_17459181854038](https://github.com/user-attachments/assets/c65c9d8a-6f42-41a5-b90a-39a951fbc0f0)

![企业微信截图_17459180063154](https://github.com/user-attachments/assets/587ed356-4d2e-4ef7-b486-4d602f59df46)

![企业微信截图_17459180175418](https://github.com/user-attachments/assets/c1fd1d07-0e52-4228-be5a-ba66c84397d7)


